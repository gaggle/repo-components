"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.clearPooledTimer=clearPooledTimer;exports.default=void 0;var _distance_in_words=_interopRequireDefault(require("date-fns/distance_in_words"));var _format=_interopRequireDefault(require("date-fns/format"));var _propTypes=_interopRequireDefault(require("prop-types"));var _react=_interopRequireWildcard(require("react"));var _dates=require("../lib/dates");function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class Timestamp extends _react.Component{constructor(props){super(props);this.state={content:"",start:(0,_dates.getDatetime)(props.startDate)}}componentWillMount(){if(this.state.start===undefined){this.state.start=new Date}this.update()}componentWillReceiveProps(){this.update()}componentWillUnmount(){removePooledElement(this)}componentDidMount(){ensurePooledTimer(this.pooledInterval);pushPooledElement(this)}update(){const newContent=(0,_distance_in_words.default)(new Date,this.state.start,{addSuffix:true,includeSeconds:true});if(newContent!==this.state.content){this.setState({content:newContent},()=>{this.props.onChange(newContent)})}}render(){return _react.default.createElement("span",{className:this.props.className,title:(0,_format.default)(this.state.start,this.props.formatStr),"data-datetime":(0,_format.default)(this.state.start),"data-dateepoch":this.state.start.getTime()},this.state.content)}}_defineProperty(Timestamp,"pooledElements",[]);_defineProperty(Timestamp,"pooledInterval",1000);_defineProperty(Timestamp,"pooledTimer",null);_defineProperty(Timestamp,"propTypes",{className:_propTypes.default.string,formatStr:_propTypes.default.string,onChange:_propTypes.default.func,startDate:_propTypes.default.oneOfType([_propTypes.default.instanceOf(Date),_propTypes.default.string])});_defineProperty(Timestamp,"defaultProps",{formatStr:"MMMM Do YYYY, HH:mm:ss",onChange:()=>{},startDate:new Date});function clearPooledTimer(){if(!Timestamp.pooledTimer)return;clearInterval(Timestamp.pooledTimer);Timestamp.pooledTimer=null;Timestamp.pooledElements=[]}function ensurePooledTimer(interval){if(Timestamp.pooledTimer)return;Timestamp.pooledTimer=setInterval(()=>{Timestamp.pooledElements.forEach(element=>{element.update()})},interval)}function pushPooledElement(element){if(!(element instanceof Timestamp)){throw new Error("Element not an instance of Timestamp")}if(Timestamp.pooledElements.indexOf(element)===-1){Timestamp.pooledElements.push(element)}}function removePooledElement(element){if(!(element instanceof Timestamp)){throw new Error("Element not an instance of Timestamp")}const index=Timestamp.pooledElements.indexOf(element);if(index!==-1){Timestamp.pooledElements.splice(index,1)}}var _default=Timestamp;exports.default=_default;
//# sourceMappingURL=Timestamp.js.map