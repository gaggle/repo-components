{"version":3,"sources":["../../src/components/Timestamp.js"],"names":["Timestamp","Component","constructor","props","state","content","start","startDate","componentWillMount","undefined","Date","update","componentWillReceiveProps","componentWillUnmount","removePooledElement","componentDidMount","ensurePooledTimer","pooledInterval","pushPooledElement","newContent","addSuffix","includeSeconds","setState","onChange","render","className","formatStr","getTime","PropTypes","string","func","oneOfType","instanceOf","clearPooledTimer","pooledTimer","clearInterval","pooledElements","interval","setInterval","forEach","element","Error","indexOf","push","index","splice"],"mappings":"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","sourcesContent":["import distanceInWords from 'date-fns/distance_in_words'\nimport format from 'date-fns/format'\nimport PropTypes from 'prop-types'\nimport React, { Component } from 'react'\n\nimport { getDatetime } from '../lib/dates'\n\n/**\n * Nice human-readable timestamp\n *\n * Time is shown relative if possible,\n * and automatically updates as that time recedes into the past.\n * `startDate` can be epoch or any date-string understood by Javascript `Date` class\n * (e.g. `1980-02-26T12:30:00+01:00`)\n */\nclass Timestamp extends Component {\n  static pooledElements = []\n  static pooledInterval = 1000\n  static pooledTimer = null\n\n  static propTypes = {\n    className: PropTypes.string,\n    formatStr: PropTypes.string,\n    onChange: PropTypes.func,\n    startDate: PropTypes.oneOfType([\n      PropTypes.instanceOf(Date),\n      PropTypes.string,\n    ]),\n  }\n\n  static defaultProps = {\n    formatStr: 'MMMM Do YYYY, HH:mm:ss',\n    onChange: () => {},\n    startDate: new Date(),\n  }\n\n  constructor (props) {\n    super(props)\n\n    this.state = {\n      content: '',\n      start: getDatetime(props.startDate),\n    }\n  }\n\n  componentWillMount () {\n    if (this.state.start === undefined) {\n      this.state.start = new Date()\n    }\n    this.update()\n  }\n\n  componentWillReceiveProps () {\n    this.update()\n  }\n\n  componentWillUnmount () {\n    removePooledElement(this)\n  }\n\n  componentDidMount () {\n    ensurePooledTimer(this.pooledInterval)\n    pushPooledElement(this)\n  }\n\n  /**\n   * Update this.state.content\n   */\n  update () {\n    const newContent = distanceInWords(\n      new Date(),\n      this.state.start,\n      {addSuffix: true, includeSeconds: true}\n    )\n    if (newContent !== this.state.content) {\n      this.setState({content: newContent}, () => {\n        this.props.onChange(newContent)\n      })\n    }\n  }\n\n  render () {\n    return (\n      <span className={this.props.className}\n            title={format(this.state.start, this.props.formatStr)}\n            data-datetime={format(this.state.start)}\n            data-dateepoch={this.state.start.getTime()}>\n        {this.state.content}\n      </span>\n    )\n  }\n}\n\nexport function clearPooledTimer () {\n  if (!Timestamp.pooledTimer) return\n\n  clearInterval(Timestamp.pooledTimer)\n  Timestamp.pooledTimer = null\n  Timestamp.pooledElements = []\n}\n\nfunction ensurePooledTimer (interval) {\n  if (Timestamp.pooledTimer) return\n\n  Timestamp.pooledTimer = setInterval(() => {\n    Timestamp.pooledElements.forEach(element => {\n      element.update()\n    })\n  }, interval)\n}\n\nfunction pushPooledElement (element) {\n  if (!(element instanceof Timestamp)) {\n    throw new Error('Element not an instance of Timestamp')\n  }\n  if (Timestamp.pooledElements.indexOf(element) === -1) {\n    Timestamp.pooledElements.push(element)\n  }\n}\n\nfunction removePooledElement (element) {\n  if (!(element instanceof Timestamp)) {\n    throw new Error('Element not an instance of Timestamp')\n  }\n  const index = Timestamp.pooledElements.indexOf(element)\n  if (index !== -1) {\n    Timestamp.pooledElements.splice(index, 1)\n  }\n}\n\nexport default Timestamp\n"],"file":"Timestamp.js"}